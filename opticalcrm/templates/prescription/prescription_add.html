{% extends 'main.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block breadcrumb %}
<style>
    .asteriskField {
        color: red;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
</style>
<div class="pagetitle">
    <h1>Add Frame </h1>
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'main' %}">Dashboard</a></li>
            <li class="breadcrumb-item">Prescription</li>
            <li class="breadcrumb-item active">Add Prescription</li>
        </ol>
    </nav>
</div>
{% endblock breadcrumb %}

{% block content %}
<div class="row">

    <div class="col-xl-12">
        <div class="card">
            <div class="card-body pt-3">
                <!-- Bordered Tabs -->

                <div class="tab-content pt-2">
                    <div class="tab-pane fade show active profile-overview" id="profile-overview">
                        <h5 class="card-title fw-bold text-center text-primary">Add Prescription</h5>
                        <form class="row g-3 needs-validation" method="POST" novalidate>
                            {% csrf_token %}

                            <div class="col-md-4">
                                <label for="customer_name_id" class="form-label">Search Customer</label>
                                <select name="customer_name" id="customer_name_id" class="form-control">
                                    <option value="" selected>-----select a Customer-----</option>
                                    {% for i in data %}
                                    <option value="{{i.pk}}">{{i.get_name|title}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <hr>
                            <div class="col-md-8">
                            </div>
                            <h5 class="fw-bold mt-4">Customer Details</h5>
                            <div class="col-md-4">
                                <label for="fname" class="form-label">First name</label>
                                <input type="text" class="form-control" id="fnameid" name="fname" required>
                                <div class="invalid-feedback">
                                    Please choose a First Name.
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="mname" class="form-label">middle name</label>
                                <input type="text" class="form-control" id="mname" name="mname" required>
                                <div class="invalid-feedback">
                                    Please choose a Middle Name.
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="lname" class="form-label">Last name</label>
                                <input type="text" class="form-control" id="lname" name="lname" required>
                                <div class="invalid-feedback">
                                    Please choose a Last Name.
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label for="mobile" class="form-label">Mobile No</label>
                                <div class="input-group has-validation">

                                    <input type="text" class="form-control" id="mobile" name="mobno"
                                        aria-describedby="inputGroupPrepend" required>

                                    <div class="invalid-feedback">
                                        Please choose a Mobile No.
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Email ID</label>
                                <div>
                                    <input type="text" id="emailid" name="emailid" class="form-control">
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label">BirthDate</label>
                                <div>
                                    <input type="date" id="bdate" name="bdate" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Age</label>
                                <div>
                                    <input type="text" id="age" name="age" class="form-control">
                                </div>
                            </div>
                            
                            <div class="col-md-12">
                                <label for="address" class="form-label">Address</label>
                                <input type="text" name="address" class="form-control" id="address" required>
                                <div class="invalid-feedback">
                                    this field required.
                                </div>
                            </div>
                            <div class="col-md-2"></div>
                            <div class="col-md-4">
                                <label for="city" class="form-label">city</label>
                                <input type="text" name="city" class="form-control" id="city" required>
                                <div class="invalid-feedback">
                                    Please provide a valid city.
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="state" class="form-label">state</label>
                                <input type="text" name="state" class="form-control" id="state" required>
                                <div class="invalid-feedback">
                                    Please provide a valid state.
                                </div>
                            </div>
                            <div class="col-md-2"></div>
                            <hr>
                            <div class="col-md-4">
                                <label for="oname" class="form-label">Optometrist Name</label>
                                <input type="text" name="oname" class="form-control" id="oname">
                            </div>
                            <hr>
                            <label class="form-label">Power Details</label>

                            <table class="table table-bordered" style="background-color: white;">
                                <tr>
                                    <td></td>
                                    <td colspan="4">RIGHT EYE</td>
                                    <td colspan="4">LEFT EYE</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td>SPH</td>
                                    <td>CYL</td>
                                    <td>AXIS</td>
                                    <td>VISION</td>
                                    <td>SPH</td>
                                    <td>CYL</td>
                                    <td>AXIS</td>
                                    <td>VISION</td>
                                </tr>
                                <tr>
                                    <td>DISTANCE</td>
                                    <td><input type="text" name="RDSPH" id="RDSPH" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="RDCYL" id="RDCYL" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="RDAXIS" id="RDAXIS" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="RDVISION" id="RDVISION" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LDSPH" id="LDSPH" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LDCYL" id="LDCYL" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LDAXIS" id="LDAXIS" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LDVISION" id="LDVISION" style="width:65px ;"
                                            class="form-control"></td>
                                </tr>
                                <tr>
                                    <td>ADD</td>
                                    <td colspan="4"><input type="text" name="RADD" id="RADD" class="form-control w-25">
                                    </td>
                                    <td colspan="4"><input type="text" name="LADD" id="LADD" class="form-control w-25">
                                    </td>
                                </tr>
                                <tr>
                                    <td>NEAR</td>
                                    <td><input type="text" name="RNSPH" id="RNSPH" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="RNCYL" id="RNCYL" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="RNAXIS" id="RNAXIS" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="RNVISION" id="RNVISION" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LNSPH" id="LNSPH" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LNCYL" id="LNCYL" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LNAXIS" id="LNAXIS" style="width:65px ;"
                                            class="form-control"></td>
                                    <td><input type="text" name="LNVISION" id="LNVISION" style="width:65px ;"
                                            class="form-control"></td>
                                </tr>
                            </table>

                            <div class="col-md-6">
                                <select name="wear" id="wearid" class="form-control">
                                    <option value="" disabled selected>-----select-----</option>
                                    <option value="Distance Wear">Distance Wear</option>
                                    <option value="Readig Wear">Readig Wear</option>
                                    <option value="Continuous Wear">Continuous Wear</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                            </div>



                            <div class="col-md-4">
                                <label for="oname" class="form-label">Prescription Notes</label>
                                <input type="text" name="pnotes" class="form-control" id="pnotes">
                            </div>





                            <div class="col-12 d-flex justify-content-center">
                                <button class="btn btn-success" type="submit" formtarget="_blank">Print</button>
                                <button class="btn btn-warning mx-1" type="reset">Reset</button>
                                <a href="" class="btn btn-secondary mx-1">Back</a>
                            </div>
                        </form>
                    </div>
                </div><!-- End Bordered Tabs -->
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/popper.min.js' %}"></script>
<script src="{% static 'js/message.js' %}"></script>

<script>
    $(document).ready(function () {
        $('#customer_name_id').select2();
        $(document).on('change', '#bdate', function () {
            var bdate = $('#bdate').val().split('-');
            var today = new Date();
            var y = today.getFullYear();
            var by = bdate[0]
            var age = y - by
            $('#age').val(age)
        });

        $(document).on('change', '#customer_name_id', function () {
            var data = $(this).val()
            console.log(data);
            $.ajax({
                url: "{% url 'prescription_ajax' %}",
                data: { 'i': data },
                success: function (data) {
                    $('#fnameid').val(data.fn)
                    $('#mname').val(data.mn)
                    $('#lname').val(data.ln)
                    $('#mobile').val(data.mb)
                    $('#emailid').val(data.em)
                    $('#address').val(data.add)
                    $('#city').val(data.ct)
                    $('#state').val(data.st)
                    $('#bdate').val(data.bd)
                    $('#age').val(data.ag)
                }
            });
        });
    });
    $('#RADD').on('keyup', function () {
        var RDSPH = $('#RDSPH').val()
        var RDCYL = $('#RDCYL').val()
        var RDAXIS = $('#RDAXIS').val()
        var RDVISION = $('#RDVISION').val()
        var RDADD = $('#RADD').val()
        var RNSPH = parseFloat(RDSPH) + parseFloat(RDADD)
        $('#RNSPH').val(RNSPH);
        $('#RNCYL').val(RDCYL);
        $('#RNAXIS').val(RDAXIS);
        $('#RNVISION').val(RDVISION);
    });
    $('#LADD').on('keyup', function () {
        var LDSPH = $('#LDSPH').val()
        var LDCYL = $('#LDCYL').val()
        var LDAXIS = $('#LDAXIS').val()
        var LDVISION = $('#LDVISION').val()
        var LADD = $('#LADD').val()
        var LNSPH = parseFloat(LDSPH) + parseFloat(LADD)
        $('#LNSPH').val(LNSPH);
        $('#LNCYL').val(LDCYL);
        $('#LNAXIS').val(LDAXIS);
        $('#LNVISION').val(LDVISION);
    });
</script>
{% if messages %}
{% for message in messages %}

<script>
    swal({
        text: "{{message}}",
        icon: "success",
    }).then(function () {
        window.location = "";
    });
</script>

{% endfor %}
{% endif %}
{% endblock content %}